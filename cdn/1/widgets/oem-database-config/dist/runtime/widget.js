/*! For license information please see widget.js.LICENSE.txt */
System.register(["jimu-core/react","esri/layers/FeatureLayer","jimu-ui","esri/identity/OAuthInfo","esri/identity/IdentityManager"],(function(e,t){var r={},n={},a={},o={},s={};return{setters:[function(e){r.Component=e.Component,r.default=e.default},function(e){n.default=e.default},function(e){a.Button=e.Button,a.Modal=e.Modal,a.ModalBody=e.ModalBody,a.ModalFooter=e.ModalFooter,a.ModalHeader=e.ModalHeader,a.NumericInput=e.NumericInput,a.TextArea=e.TextArea,a.TextInput=e.TextInput},function(e){o.default=e.default},function(e){s.default=e.default}],execute:function(){e((()=>{var e={380:e=>{"use strict";e.exports=s},263:e=>{"use strict";e.exports=o},818:e=>{"use strict";e.exports=n},315:e=>{"use strict";e.exports=r},726:e=>{"use strict";e.exports=a}},t={};function l(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,l),a.exports}l.d=(e,t)=>{for(var r in t)l.o(t,r)&&!l.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var i={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(i),l.d(i,{__set_webpack_public_path__:()=>P,default:()=>L});var e=l(315),t=function(){return t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},t.apply(this,arguments)};function r(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e}var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)},a=function(){return a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a.apply(this,arguments)};function o(e,t,r){var n=a(a({params:{}},r),e);return n.params=t.reduce((function(t,r){return(e[r]||"boolean"==typeof e[r])&&(t[r]=e[r]),t}),n.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce((function(e,t){return n[t]&&(e[t]=n[t]),e}),{})}function s(e){return Object.keys(e).some((function(t){var r=e[t];if(!r)return!1;switch(r&&r.toParam&&(r=r.toParam()),r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function c(e){var t={};return Object.keys(e).forEach((function(r){var n,a,o=e[r];if(o&&o.toParam&&(o=o.toParam()),o||0===o||"boolean"==typeof o||"string"==typeof o){var s;switch(o.constructor.name){case"Array":var l=null===(a=null===(n=o[0])||void 0===n?void 0:n.constructor)||void 0===a?void 0:a.name;s="Array"===l?o:"Object"===l?JSON.stringify(o):o.join(",");break;case"Object":s=JSON.stringify(o);break;case"Date":s=o.valueOf();break;case"Function":s=null;break;case"Boolean":s=o+"";break;default:s=o}(s||0===s||"string"==typeof s||Array.isArray(s))&&(t[r]=s)}})),t}function u(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((function(t){return u(e,t)})).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function d(e){var t=c(e);return Object.keys(t).map((function(e){return u(e,t[e])})).join("&")}var p=function(e,t,r,n,a){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=a};p.prototype=Object.create(Error.prototype),p.prototype.constructor=p;var h="@esri/arcgis-rest-js",f={httpMethod:"POST",params:{f:"json"}},m=function(e){function t(t,r,n,a,o){void 0===t&&(t="AUTHENTICATION_ERROR"),void 0===r&&(r="AUTHENTICATION_ERROR_CODE");var s=e.call(this,t,r,n,a,o)||this;return s.name="ArcGISAuthError",s.message="AUTHENTICATION_ERROR_CODE"===r?t:r+": "+t,s}return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t.prototype.retry=function(e,t){var r=this;void 0===t&&(t=3);var n=0,o=function(s,l){e(r.url,r.options).then((function(e){var t=a(a({},r.options),{authentication:e});return n+=1,g(r.url,t)})).then((function(e){s(e)})).catch((function(e){"ArcGISAuthError"===e.name&&n<t?o(s,l):"ArcGISAuthError"===e.name&&n>=t?l(r):l(e)}))};return new Promise((function(e,t){o(e,t)}))},t}(p);function g(e,t){void 0===t&&(t={params:{f:"json"}});var r=a(a(a({httpMethod:"POST"},f),t),{params:a(a({},f.params),t.params),headers:a(a({},f.headers),t.headers)}),n=[],o=[];if(r.fetch||"undefined"==typeof fetch?(n.push("`fetch`"),o.push("`node-fetch`")):r.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(n.push("`Promise`"),o.push("`es6-promise`")),"undefined"==typeof FormData&&(n.push("`FormData`"),o.push("`isomorphic-form-data`")),!r.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+n.join(", ")+". We recommend installing the "+o.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var l=r.httpMethod,i=r.authentication,u=r.rawResponse,g=a({f:"json"},r.params),y=null,E={method:l,credentials:r.credentials||"same-origin"};return r.headers&&r.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(E.credentials="include"),(i?i.getToken(e,{fetch:r.fetch}).catch((function(t){return t.url=e,t.options=r,y=t,Promise.resolve("")})):Promise.resolve("")).then((function(t){t.length&&(g.token=t),i&&i.getDomainCredentials&&(E.credentials=i.getDomainCredentials(e));var n={};if("GET"===E.method){g.token&&r.hideToken&&"undefined"==typeof window&&(n["X-Esri-Authorization"]="Bearer "+g.token,delete g.token);var o=""===d(g)?e:e+"?"+d(g);r.maxUrlLength&&o.length>r.maxUrlLength||g.token&&r.hideToken?(E.method="POST",t.length&&r.hideToken&&(g.token=t,delete n["X-Esri-Authorization"])):e=o}var l=new RegExp("/items/.+/updateResources").test(e);return"POST"===E.method&&(E.body=function(e,t){var r=s(e)||t,n=c(e);if(r){var a=new FormData;return Object.keys(n).forEach((function(e){if("undefined"!=typeof Blob&&n[e]instanceof Blob){var t=n.fileName||n[e].name||e;a.append(e,n[e],t)}else n[e].constructor&&"ReadStream"===n[e].constructor.name&&Number.isInteger(n.dataSize)?a.append(e,n[e],{knownLength:n.dataSize}):a.append(e,n[e])})),a}return d(e)}(g,l)),E.headers=a(a({},n),r.headers),"undefined"!=typeof window||E.headers.referer||(E.headers.referer=h),s(g)||l||(E.headers["Content-Type"]="application/x-www-form-urlencoded"),r.fetch(e,E)})).then((function(t){if(!t.ok){var n=t.status,a=t.statusText;throw new p(a,"HTTP "+n,t,e,r)}if(u)return t;switch(g.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((function(t){if("json"!==g.f&&"geojson"!==g.f||u)return t;var n=function(e,t,r,n,a){if(e.code>=400){var o=e.message,s=e.code;throw new p(o,s,e,t,n)}if(e.error){var l=e.error,i=(o=l.message,s=l.code,l.messageCode),c=i||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s||"GWM_0003"===i||400===s&&"Unable to generate token."===o)throw a||new m(o,c,e,t,n);throw new p(o,c,e,t,n)}if("failed"===e.status||"failure"===e.status){o=void 0,s="UNKNOWN_ERROR_CODE";try{o=JSON.parse(e.statusMessage).message,s=JSON.parse(e.statusMessage).code}catch(t){o=e.statusMessage||e.message}throw new p(o,s,e,t,n)}return e}(t,e,0,r,y);if(y){var a=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];r.authentication.federatedServers[a]={token:[],expires:new Date(Date.now()+864e5)},y=null}return n}))}function y(e){return g(r(e.url)+"/addFeatures",o(e,["features","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:t({},e.params)}))}function E(e){return g(r(e.url)+"/deleteFeatures",o(e,["where","objectIds","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:t({},e.params)}))}var O=function(){return O=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},O.apply(this,arguments)},v=function(){function e(e){this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.token=e.token,this.expires=e.expires,this.portal=e.portal||"https://www.arcgis.com/sharing/rest",this.duration=e.duration||7200}return e.prototype.getToken=function(e,t){return this.token&&this.expires&&this.expires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequest||(this._pendingTokenRequest=this.refreshToken(t)),this._pendingTokenRequest)},e.prototype.refreshToken=function(e){var t=this,r=O({params:{client_id:this.clientId,client_secret:this.clientSecret,grant_type:"client_credentials",expiration:this.duration}},e);return function(e,t){var r=t;return r.rawResponse=!1,g(e,r).then((function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl};return e.refresh_token&&(t.refreshToken=e.refresh_token),t}))}(this.portal+"/oauth2/token/",r).then((function(e){return t._pendingTokenRequest=null,t.token=e.token,t.expires=e.expires,e.token}))},e.prototype.refreshSession=function(){var e=this;return this.refreshToken().then((function(){return e}))},e}(),b=l(818),T=l(726);class S extends e.Component{constructor(e){super(e),this.toggleOpen=()=>{this.setState({open:!this.state.open})},this.close=()=>{this.props.addLayer(this.state.title,this.state.url,this.state.scope,this.state.source,this.state.description,this.state.categoryId,this.state.renderer),this.toggleOpen()},this.state={title:null,url:null,scope:null,source:null,description:null,categoryId:-1,renderer:null,open:!1}}render(){return e.default.createElement("div",null,e.default.createElement(T.Button,{onClick:this.toggleOpen},"Add Layer"),e.default.createElement(T.Modal,{isOpen:this.state.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:function(){},toggle:this.toggleOpen},e.default.createElement(T.ModalHeader,{toggle:this.toggleOpen},"Add Layer"),e.default.createElement(T.ModalBody,null,e.default.createElement(T.TextInput,{className:"mb-3",placeholder:"Enter Layer Title...",onAcceptValue:e=>this.setState({title:e})}),e.default.createElement(T.TextInput,{className:"mb-3",placeholder:"Enter Layer URL...",onAcceptValue:e=>this.setState({url:e})}),e.default.createElement(T.TextInput,{className:"mb-3",placeholder:"Enter Layer Scope...",onAcceptValue:e=>this.setState({scope:e})}),e.default.createElement(T.TextInput,{className:"mb-3",placeholder:"Enter Layer Source...",onAcceptValue:e=>this.setState({source:e})}),e.default.createElement(T.TextArea,{className:"mb-3",placeholder:"Enter Layer Description...",onAcceptValue:e=>this.setState({description:e})}),e.default.createElement("label",null,"Enter Category ID:"," ",e.default.createElement(T.NumericInput,{onAcceptValue:e=>this.setState({categoryId:+e})})),e.default.createElement(T.TextArea,{className:"mb-3",placeholder:"Enter Layer Renderer (Optional)...",onAcceptValue:e=>this.setState({renderer:e})})),e.default.createElement(T.ModalFooter,null,e.default.createElement(T.Button,{onClick:this.close},"Save"))))}}const k=S;class I extends e.Component{constructor(e){super(e),this.toggleOpen=()=>{this.setState({open:!this.state.open})},this.close=()=>{this.props.deleteLayer(this.state.id),this.toggleOpen()},this.state={id:null,open:!1}}render(){return e.default.createElement("div",null,e.default.createElement(T.Button,{onClick:this.toggleOpen},"Delete Layer"),e.default.createElement(T.Modal,{isOpen:this.state.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:function(){},toggle:this.toggleOpen},e.default.createElement(T.ModalHeader,{toggle:this.toggleOpen},"Delete Layer"),e.default.createElement(T.ModalBody,null,e.default.createElement("label",null,"Enter Object ID:"," ",e.default.createElement(T.NumericInput,{onAcceptValue:e=>this.setState({id:+e})}))),e.default.createElement(T.ModalFooter,null,e.default.createElement(T.Button,{onClick:this.close},"Save"))))}}const C=I;class w extends e.Component{constructor(e){super(e),this.toggleOpen=()=>{this.setState({open:!this.state.open})},this.close=()=>{this.props.deleteTemplate(this.state.id),this.toggleOpen()},this.state={id:null,open:!1}}render(){return e.default.createElement("div",null,e.default.createElement(T.Button,{onClick:this.toggleOpen},"Delete Template"),e.default.createElement(T.Modal,{isOpen:this.state.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:function(){},toggle:this.toggleOpen},e.default.createElement(T.ModalHeader,{toggle:this.toggleOpen},"Delete Template"),e.default.createElement(T.ModalBody,null,e.default.createElement("label",null,"Enter Object ID:"," ",e.default.createElement(T.NumericInput,{onAcceptValue:e=>this.setState({id:+e})}))),e.default.createElement(T.ModalFooter,null,e.default.createElement(T.Button,{onClick:this.close},"Save"))))}}const R=w;class x extends e.Component{constructor(e){super(e),this.toggleOpen=()=>{this.setState({open:!this.state.open})},this.close=()=>{this.props.addCategory(this.state.title),this.toggleOpen()},this.state={title:null,open:!1}}render(){return e.default.createElement("div",null,e.default.createElement(T.Button,{onClick:this.toggleOpen},"Add Category"),e.default.createElement(T.Modal,{isOpen:this.state.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:function(){},toggle:this.toggleOpen},e.default.createElement(T.ModalHeader,{toggle:this.toggleOpen},"Add Category"),e.default.createElement(T.ModalBody,null,e.default.createElement(T.TextInput,{className:"mb-3",placeholder:"Enter Category Title...",onAcceptValue:e=>this.setState({title:e})})),e.default.createElement(T.ModalFooter,null,e.default.createElement(T.Button,{onClick:this.close},"Save"))))}}const _=x;class A extends e.Component{constructor(e){super(e),this.toggleOpen=()=>{this.setState({open:!this.state.open})},this.close=()=>{this.props.deleteCategory(this.state.id),this.toggleOpen()},this.state={id:null,open:!1}}render(){return e.default.createElement("div",null,e.default.createElement(T.Button,{onClick:this.toggleOpen},"Delete Category"),e.default.createElement(T.Modal,{isOpen:this.state.open,onClosed:function(){},onEnter:function(){},onExit:function(){},onOpened:function(){},toggle:this.toggleOpen},e.default.createElement(T.ModalHeader,{toggle:this.toggleOpen},"Delete Category"),e.default.createElement(T.ModalBody,null,e.default.createElement("label",null,"Enter Object ID:"," ",e.default.createElement(T.NumericInput,{onAcceptValue:e=>this.setState({id:+e})}))),e.default.createElement(T.ModalFooter,null,e.default.createElement(T.Button,{onClick:this.close},"Save"))))}}const D=A;var M=l(263),j=l(380),N=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function s(e){try{i(n.next(e))}catch(e){o(e)}}function l(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,l)}i((n=n.apply(e,t||[])).next())}))};class U extends e.Component{constructor(){super(...arguments),this.appSession=new v({clientId:this.props.config.clientId,clientSecret:this.props.config.clientSecret}),this.templateTableUrl="https://services1.arcgis.com/UWYHeuuJISiGmgXx/arcgis/rest/services/OEM_Database_v2/FeatureServer/1",this.layerTableUrl="https://services1.arcgis.com/UWYHeuuJISiGmgXx/arcgis/rest/services/OEM_Database_v2/FeatureServer/0",this.categoryTableUrl="https://services1.arcgis.com/UWYHeuuJISiGmgXx/arcgis/rest/services/OEM_Database_v2/FeatureServer/2",this.templateLayerRelationshipsUrl="https://services1.arcgis.com/UWYHeuuJISiGmgXx/arcgis/rest/services/OEM_Database_v2/FeatureServer/3",this.addLayer=(e,t,r,n,a,o,s)=>N(this,void 0,void 0,(function*(){try{s?yield y({url:this.layerTableUrl,features:[{attributes:{TITLE:e,URL:t,SCOPE:r,SOURCE:n,DESCRIPTION:a,CATEGORYID:o,RENDERER:s}}],params:{token:yield this.getToken()}}):yield y({url:this.layerTableUrl,features:[{attributes:{TITLE:e,URL:t,SCOPE:r,SOURCE:n,DESCRIPTION:a,CATEGORYID:o}}],params:{token:yield this.getToken()}}),alert("Successfully added layer!")}catch(e){console.error(e),alert("Error adding layer, please try again!")}})),this.deleteLayer=e=>N(this,void 0,void 0,(function*(){try{try{let t=yield this.templateLayerRelationships.queryFeatures({where:"LAYERID = '"+e+"'",outFields:["OBJECTID"]}),r=[];for(let e of t.features)r.push(e.attributes.OBJECTID);r.length>0&&(yield E({url:this.templateLayerRelationshipsUrl,objectIds:r,params:{token:yield this.getToken()}}))}catch(e){console.error(e),alert("Error deleting template layer relationships, please try again!")}yield E({url:this.layerTableUrl,objectIds:[e],params:{token:yield this.getToken()}}),alert("Successfully deleted layer!")}catch(e){console.error(e),alert("Error deleting layer, please try again!")}})),this.deleteTemplate=e=>N(this,void 0,void 0,(function*(){try{try{let t=yield this.templateLayerRelationships.queryFeatures({where:"TEMPLATEID = '"+e+"'",outFields:["OBJECTID"]}),r=[];for(let e of t.features)r.push(e.attributes.OBJECTID);r.length>0&&(yield E({url:this.templateLayerRelationshipsUrl,objectIds:r,params:{token:yield this.getToken()}}))}catch(e){console.error(e),alert("Error deleting template layer relationships, please try again!")}yield E({url:this.templateTableUrl,objectIds:[e],params:{token:yield this.getToken()}}),alert("Successfully deleted template!")}catch(e){console.error(e),alert("Error deleting template, please try again!")}})),this.addCategory=e=>N(this,void 0,void 0,(function*(){try{yield y({url:this.categoryTableUrl,features:[{attributes:{TITLE:e}}],params:{token:yield this.getToken()}}),alert("Successfully added category!")}catch(e){console.error(e),alert("Error adding layer, please try again!")}})),this.deleteCategory=e=>N(this,void 0,void 0,(function*(){try{yield E({url:this.categoryTableUrl,objectIds:[e],params:{token:this.getToken()}}),alert("Successfully deleted category!")}catch(e){console.error(e),alert("Error deleting category, please try again!")}})),this.getToken=()=>N(this,void 0,void 0,(function*(){const e=new M.default({appId:"eS2vUdIZbHaVOrDz",flowType:"auto",popup:!1});j.default.registerOAuthInfos([e]);let t=yield j.default.checkSignInStatus(e.portalUrl+"/sharing");return t||(t=yield j.default.getCredential(e.portalUrl+"/sharing")),t.token}))}componentDidMount(){try{this.templateTable=new b.default({url:this.templateTableUrl}),this.layerTable=new b.default({url:this.layerTableUrl}),this.categoryTable=new b.default({url:this.categoryTableUrl}),this.templateLayerRelationships=new b.default({url:this.templateLayerRelationshipsUrl})}catch(e){return console.error(e),void alert("Error connecting to database, please try again!")}}render(){return e.default.createElement("div",null,e.default.createElement(k,{addLayer:this.addLayer}),e.default.createElement(C,{deleteLayer:this.deleteLayer}),e.default.createElement(R,{deleteTemplate:this.deleteTemplate}),e.default.createElement(_,{addCategory:this.addCategory}),e.default.createElement(D,{deleteCategory:this.deleteCategory}))}}const L=U;function P(e){l.p=e}})(),i})())}}}));